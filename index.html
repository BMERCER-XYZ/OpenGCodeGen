<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenGCodeGen - Simple G-Code Generator</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Import Map for Three.js -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <style>
        /* Simple Tab Styles */
        .tab-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .tab-btn {
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-weight: bold;
            color: #888;
        }
        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        #three-container {
            width: 100%;
            height: 400px;
            background: #000;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <nav class="container-fluid">
        <ul style="flex-grow: 1; justify-content: center;">
            <li>
                <pre style="font-family: monospace; font-size: 6px; line-height: 6px; margin: 0; color: var(--primary-color);">
   ____                      ______      ______          __        ______                           __            
  / __ \____  ___  ____     / ____/     / ____/___  ____/ /__     / ____/__  ____  ___  _________ _/ /_____  _____
 / / / / __ \/ _ \/ __ \   / / ________/ /   / __ \/ __  / _ \   / / __/ _ \/ __ \/ _ \/ ___/ __ `/ __/ __ \/ ___/
/ /_/ / /_/ /  __/ / / /  / /_/ /_____/ /___/ /_/ / /_/ /  __/  / /_/ /  __/ / / /  __/ /  / /_/ / /_/ /_/ / /    
\____/ .___/\___/_/ /_/   \____/      \____/\____/\__,_/\___/   \____/\___/_/ /_/\___/_/   \__,_/\__/\____/_/     
    /_/                                                                                                           
                </pre>
            </li>
        </ul>
        <ul>
            <li><button id="generateBtn" role="button">Generate G-Code</button></li>
            <li><a href="#" role="button" id="downloadBtn" class="secondary">Download .gcode</a></li>
        </ul>
    </nav>

    <main class="container">
        <!-- Top Row: Left Controls | Visualizer | Right Controls -->
        <div class="grid main-grid">
            <!-- Left Column: Shape & Stock -->
            <section id="controls-left">
                <h3>Configuration</h3>
                
                <!-- Shape Selection -->
                <label for="shapeSelect">Geometry</label>
                <select id="shapeSelect">
                    <option value="square">Square</option>
                    <option value="rectangle">Rectangle</option>
                    <option value="circle">Circle</option>
                    <option value="sketch">Sketch</option>
                </select>

                <hr>

                <!-- Dimensions (Dynamic based on shape) -->
                <div id="dimensionInputs">
                    <!-- Injected via JS -->
                </div>

                <!-- Stock Settings -->
                <details open>
                    <summary>Stock & Origin</summary>
                    <div class="grid">
                        <label>
                            Stock Width (mm)
                            <input type="number" id="stockWidth" placeholder="Auto" step="1">
                        </label>
                        <label>
                            Stock Height (mm)
                            <input type="number" id="stockHeight" placeholder="Auto" step="1">
                        </label>
                    </div>
                    <label>
                        Stock Thickness (mm)
                        <input type="number" id="stockThickness" placeholder="Optional" step="0.5">
                    </label>
                    <label for="originSelect">Job Origin (Home)</label>
                    <select id="originSelect">
                        <optgroup label="Stock">
                            <option value="stock-center">Center of Stock</option>
                            <option value="stock-bottom-left">Stock Bottom Left</option>
                            <option value="stock-bottom-right">Stock Bottom Right</option>
                            <option value="stock-top-left">Stock Top Left</option>
                            <option value="stock-top-right">Stock Top Right</option>
                        </optgroup>
                        <optgroup label="Shape">
                            <option value="shape-center">Center of Shape</option>
                            <option value="shape-bottom-left">Shape Bottom Left</option>
                            <option value="shape-bottom-right">Shape Bottom Right</option>
                            <option value="shape-top-left">Shape Top Left</option>
                            <option value="shape-top-right">Shape Top Right</option>
                        </optgroup>
                    </select>
                </details>
            </section>

            <!-- Center Column: Visualizer -->
            <section id="preview-area">
                <article>
                    <nav class="tab-nav">
                        <button class="tab-btn active" data-tab="view-2d">2D Preview</button>
                        <button class="tab-btn" data-tab="view-3d">3D Visualizer</button>
                        <button class="tab-btn" data-tab="view-sketch">Sketch</button>
                        <button class="tab-btn" data-tab="view-combined">G-Code</button>
                    </nav>

                    <div id="view-2d" class="tab-content active">
                        <div class="canvas-container">
                            <canvas id="previewCanvas" width="500" height="400"></canvas>
                        </div>
                        <footer>
                            <small>Grid: 10mm spacing. Origin (0,0) is center of canvas.</small>
                        </footer>
                    </div>

                    <div id="view-3d" class="tab-content">
                        <div id="three-container"></div>
                        <footer>
                            <small>Left Click: Rotate | Right Click: Pan | Scroll: Zoom</small>
                        </footer>
                    </div>

                    <div id="view-sketch" class="tab-content">
                        <div style="margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
                            <button id="clearSketchBtn" class="outline small secondary">Clear</button>
                            <span style="border-left: 1px solid #ccc; height: 20px; margin: 0 5px;"></span>
                            <small>Zoom:</small>
                            <button id="zoomInBtn" class="outline small">+</button>
                            <button id="zoomOutBtn" class="outline small">-</button>
                            <span style="border-left: 1px solid #ccc; height: 20px; margin: 0 5px;"></span>
                            <small>Grid:</small>
                            <button id="gridIncBtn" class="outline small">+</button>
                            <span id="gridSizeDisplay">10mm</span>
                            <button id="gridDecBtn" class="outline small">-</button>
                            
                            <small style="margin-left: auto;">Click start to close.</small>
                        </div>
                        <div class="canvas-container">
                            <canvas id="sketchCanvas" width="500" height="400"></canvas>
                        </div>
                    </div>

                    <div id="view-combined" class="tab-content">
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                            <!-- Left: Simulation -->
                            <div>
                                <div style="margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
                                    <button id="simStartBtn" class="outline small">|&lt;</button>
                                    <button id="simPlayBtn" class="outline small">&gt;</button>
                                    <button id="simPauseBtn" class="outline small">||</button>
                                    <button id="simEndBtn" class="outline small">&gt;|</button>
                                    <span style="border-left: 1px solid #ccc; height: 20px; margin: 0 5px;"></span>
                                    <small>Speed:</small>
                                    <button id="simSlowerBtn" class="outline small">-</button>
                                    <span id="simSpeedDisplay">1x</span>
                                    <button id="simFasterBtn" class="outline small">+</button>
                                </div>
                                <div id="sim-container" style="width: 100%; height: 400px; background: #000; overflow: hidden;"></div>
                                <div id="simStats" class="grid" style="margin-top: 1rem; text-align: center; grid-template-columns: 1fr 1fr;">
                                    <div><strong>Total Time:</strong> <span id="estTotalTime">00:00</span></div>
                                    <div><strong>Avg Pass Time:</strong> <span id="estPassTime">00:00</span></div>
                                </div>
                                <footer style="margin-top: 1rem; padding-top: 0.5rem;">
                                    <small>Left Click: Rotate | Right Click: Pan | Scroll: Zoom</small>
                                </footer>
                            </div>
                            
                            <!-- Right: Text Output -->
                            <div style="display: flex; flex-direction: column;">
                                <label for="gcodeOutput">Generated Output</label>
                                <textarea id="gcodeOutput" style="flex-grow: 1; min-height: 400px; font-family: monospace; font-size: 0.85rem;" readonly></textarea>
                            </div>
                        </div>
                    </div>
                </article>
            </section>

            <!-- Right Column: Tool Settings -->
            <section id="controls-right">
                <h3>Tooling</h3>
                <!-- Tool Settings -->
                <details open>
                    <summary>Tool & Operation</summary>

                    <label for="toolPreset">Tool Preset</label>
                    <div class="grid">
                        <select id="toolPreset">
                            <option value="">Custom</option>
                        </select>
                        <button id="saveToolBtn" class="outline">Save Preset</button>
                    </div>
                    <small>Save to <code>/tool-library</code> to use later.</small>
                    <hr>
                    
                    <label>
                        Operation Type
                        <select id="opType">
                            <option value="contour">2D Contour</option>
                            <option value="facing">Facing</option>
                        </select>
                    </label>

                    <div class="grid">
                        <label>
                            Tool Diameter (mm)
                            <input type="number" id="toolDiameter" value="3.175" step="0.1">
                        </label>
                    </div>
                </details>
            </section>
        </div>

        <!-- Bottom Row: Other Settings -->
        <div class="grid">
            <!-- Cut Settings -->
            <section>
                <details open>
                    <summary>Cut Settings</summary>
                    <div class="grid">
                        <label>
                            Target Depth (mm)
                            <input type="number" id="targetDepth" value="5.0" step="0.5">
                        </label>
                        <label>
                            Depth per Pass (mm)
                            <input type="number" id="passDepth" value="1.0" step="0.1">
                        </label>
                    </div>
                    <div class="grid">
                        <label>
                            Safe Z (mm)
                            <input type="number" id="safeZ" value="5.0" step="1.0">
                        </label>
                        <label>
                            Spindle Speed (RPM)
                            <input type="number" id="spindleSpeed" value="12000" step="100">
                        </label>
                    </div>
                    <label>
                        Feed Rate (mm/min)
                        <input type="number" id="feedRate" value="800" step="50">
                    </label>

                    <hr>

                    <label>
                        <input type="checkbox" id="enableRapid" role="switch">
                        Enable Custom Rapid Speeds
                    </label>
                    <div class="grid">
                        <label>
                            Rapid XY (mm/min)
                            <input type="number" id="rapidXY" value="7000" step="100" disabled>
                        </label>
                        <label>
                            Rapid Z (mm/min)
                            <input type="number" id="rapidZ" value="500" step="50" disabled>
                        </label>
                    </div>
                </details>
            </section>

            <!-- Configuration Row -->
            <section>
                <!-- Operation Configuration -->
                <details open>
                    <summary>Operation Configuration</summary>
                    
                    <div id="contourConfig">
                        <label>
                            Contour Side
                            <select id="operation">
                                <option value="outside">Outside (Cut Out)</option>
                                <option value="inside">Inside (Hole)</option>
                                <option value="center">On Line (Trace)</option>
                            </select>
                        </label>
                    </div>

                    <div id="facingConfig" class="grid">
                        <label>
                            Stepover (mm)
                            <input type="number" id="stepover" value="1.5" step="0.1">
                        </label>
                        <label>
                            Pass Extension X (mm)
                            <input type="number" id="passExtX" value="0.0" step="1.0">
                        </label>
                        <label>
                            Pass Extension Y (mm)
                            <input type="number" id="passExtY" value="0.0" step="1.0">
                        </label>
                    </div>
                </details>

                <!-- Tab Settings -->
                <details>
                    <summary>Tabs</summary>
                    <label>
                        <input type="checkbox" id="enableTabs" role="switch">
                        Enable Tabs
                    </label>
                    
                    <div class="grid">
                        <label>
                            Tab Width (mm)
                            <input type="number" id="tabWidth" value="6.0" step="0.5" disabled>
                        </label>
                        <label>
                            Tab Thickness (mm)
                            <input type="number" id="tabThickness" value="2.0" step="0.5" disabled>
                        </label>
                    </div>

                    <div id="tabContainer" style="display: none;">
                        <hr>
                        <h6>Tab Locations</h6>
                        <div id="tabList">
                            <!-- Dynamic Tabs -->
                        </div>
                        <button id="addTabBtn" class="outline small" style="margin-top: 1rem;">+ Add Tab</button>
                    </div>
                </details>
            </section>
        </div>
    </main>

    <footer class="container">
        <small>Proudly Build By BMERCER.XYZ</small>
    </footer>

    <script type="module" src="ui.js"></script>
</body>
</html>